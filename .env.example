# ===========================================
# Database Configuration (PostgreSQL推奨)
# ===========================================
# DATABASE_TYPE determines the storage backend:
# - postgres: PostgreSQL（本番運用推奨）- Supabase, Neon, AWS RDS等
# - kv: Vercel KV（開発・小規模テスト用）- 無料枠で保存数制限あり
# - sqlite: Local SQLite（ローカル開発用）
DATABASE_TYPE=postgres

# PostgreSQL接続（DATABASE_TYPE=postgresの場合）
DATABASE_URL=postgresql://user:password@localhost:5432/llm_trace_lens

# ===========================================
# Vercel KV（DATABASE_TYPE=kvの場合、開発・小規模テスト用）
# ===========================================
# Create a KV store in Vercel Dashboard and copy the credentials here
KV_REST_API_URL=https://your-kv-instance.kv.vercel-storage.com
KV_REST_API_TOKEN=your-kv-token

# ===========================================
# トレース保持ポリシー（KV使用時）
# ===========================================
# KVストレージの容量制限を管理します
MAX_TRACES=5000          # ワークスペースあたりの最大トレース数
MAX_AGE_DAYS=30          # トレース保存期間（日数）

# ===========================================
# Server Configuration
# ===========================================
PORT=3000
NODE_ENV=development
LOG_LEVEL=info
MAX_RETRIES=3
TIMEOUT_MS=30000

# ===========================================
# Local Development Only - API Keys
# ===========================================
# For SaaS deployment, API keys are managed via /setup UI (stored in Vercel KV)
# For local development without KV, you can set keys here:
OPENAI_API_KEY=sk-your-api-key-here
ANTHROPIC_API_KEY=your_anthropic_api_key_here
GOOGLE_API_KEY=your_google_api_key_here
DEEPSEEK_API_KEY=your_deepseek_api_key_here

# ===========================================
# Authentication (optional)
# ===========================================
ENABLE_AUTH=false
API_KEYS=your-secret-key-1,your-secret-key-2

# ===========================================
# Admin API (for threshold management)
# ===========================================
# Admin API Key for debug endpoints (validation config management)
# Required for /admin/* endpoints
ADMIN_API_KEY=your-secure-admin-key-here

# ===========================================
# OAuth/SSO Configuration
# ===========================================
# Google OAuth (for Dashboard SSO)
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# Microsoft Entra ID (Azure AD)
# Get these from Azure Portal > Azure Active Directory > App registrations
AZURE_AD_CLIENT_ID=your_azure_client_id
AZURE_AD_CLIENT_SECRET=your_azure_client_secret
AZURE_AD_TENANT_ID=your_tenant_id  # Use 'common' for multi-tenant

# ===========================================
# PostgreSQL Configuration (if DATABASE_TYPE=postgres)
# ===========================================
# 本番運用では PostgreSQL を強く推奨します
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_password
POSTGRES_DB=llm_trace_lens

# Supabase/Neon PostgreSQL（接続文字列を使用）
# POSTGRES_URL=postgresql://postgres:password@db.xxxx.supabase.co:5432/postgres

# ===========================================
# SQLite Configuration (ローカル開発用)
# ===========================================
DB_TYPE=sqlite  # Options: sqlite, postgres
SQLITE_PATH=./data/traces.db

# ===========================================
# Webhook Configuration
# ===========================================
WEBHOOK_ENABLED=false
WEBHOOK_URL=https://your-webhook-endpoint.com/notify
WEBHOOK_EVENTS=BLOCK,WARN,COST_ALERT
WEBHOOK_TIMEOUT_MS=5000
WEBHOOK_MAX_RETRIES=3

# ===========================================
# Budget Configuration
# ===========================================
# MONTHLY_BUDGET=100
# BUDGET_ALERT_THRESHOLDS=0.8,0.95

# ===========================================
# Rate Limiting
# ===========================================
RATE_LIMIT_ENABLED=false
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW_MS=60000

# ===========================================
# Email / SMTP Configuration (for reports)
# ===========================================
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=user@example.com
SMTP_PASS=your_password
SMTP_FROM=reports@llm-trace-lens.com

# ===========================================
# LLM-as-Judge Evaluation (Phase 1 MVP)
# ===========================================
# Enable automatic evaluation of LLM responses using LLM-as-Judge
ENABLE_EVALUATION=false
# Model to use for evaluation (must be OpenAI compatible)
EVALUATION_MODEL=gpt-4o-mini

# ===========================================
# Secret Manager (Encrypted API Key Storage)
# ===========================================
# 顧客APIキーを暗号化して安全に保存するための設定
# 本番環境では必ず設定してください

# 暗号化キー（32バイト、Base64エンコード）
# 生成方法: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
SECRET_ENCRYPTION_KEY=

# ベースURL（顧客に提供するエンドポイントURL）
BASE_URL=https://your-domain.com

# ===========================================
# APIキーキャッシュ設定
# ===========================================
API_KEY_CACHE_TTL=300        # キャッシュ有効期限（秒）デフォルト5分
API_KEY_EXPIRY_DAYS=90       # APIキー有効期限（日）デフォルト90日
ENABLE_API_KEY_CACHE=true    # キャッシュ有効/無効

# ===========================================
# 顧客オンボーディング設定
# ===========================================
# 事業フロー（OpenAI SDK完全互換）:
# 1. 管理者がADMIN_API_KEYを使って /admin/onboarding/customer にPOST
# 2. 顧客のLLMプロバイダAPIキーを暗号化して保存
# 3. 顧客専用のAPIキー（sk-ltl-xxxxx）を発行
# 4. 顧客はbaseURLを変更するだけで利用可能！
#
# 顧客側の設定例（Python）:
#   from openai import OpenAI
#   client = OpenAI(
#       api_key="sk-ltl-xxxxx",  # オンボーディング時に発行されたキー
#       base_url="https://your-domain.com/v1"
#   )
#
# X-Workspace-IDヘッダーは不要です！
# APIキーからワークスペースが自動的に特定されます。
#
# キーローテーション:
# - デフォルト90日ごとにローテーション推奨
# - /admin/api-keys/expiring でローテーション必要なキーを確認
# - /admin/api-keys/issue で新しいキーを発行
